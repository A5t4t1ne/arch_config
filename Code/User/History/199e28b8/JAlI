# FROM centos:7

# ARG USER_ID=14
# ARG GROUP_ID=50

# RUN yum -y update && yum clean all
# RUN yum install -y \
# 	vsftpd \
# 	db4-utils \
# 	db4 \
# 	iproute && yum clean all

# RUN usermod -u ${USER_ID} ftp
# RUN groupmod -g ${GROUP_ID} ftp
# RUN mkdir -p /var/run/ftp/pub

# COPY vsftpd.conf /etc/vsftpd/vsftpd.conf
# RUN chmod 644 /etc/vsftpd/vsftpd.conf

# # RUN chmod +x /usr/sbin/run-vsftpd.sh
# # RUN mkdir -p /home/vsftpd/
# # RUN chown -R ftp:ftp /home/vsftpd/

# EXPOSE 20 21

# CMD ["/usr/sbin/vsftpd","-obackground=NO"]

# Dockerfile for vsftpd on CentOS
FROM centos:7

RUN yum -y update; yum -y install which vsftpd net-tools vsftpd-sysvinit; yum clean all

COPY vusers.txt /etc/vsftpd/
RUN db_load -T -t hash -f /etc/vsftpd/vusers.txt /etc/vsftpd/vsftpd-virtual-user.db; rm -v /etc/vsftpd/vusers.txt; \ 
	chmod 600 /etc/vsftpd/vsftpd-virtual-user.db
COPY vsftpd.conf /etc/vsftpd/
# COPY vsftpd.virtual /etc/pam.d/
RUN mkdir -p /home/vftp/ftpuser; chown -R ftp:ftp /home/vftp

EXPOSE 20 21

CMD ["/usr/sbin/vsftpd","-obackground=NO"]
